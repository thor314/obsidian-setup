var v=Object.create;var p=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var b=s=>p(s,"__esModule",{value:!0});var N=(s,e)=>{b(s);for(var t in e)p(s,t,{get:e[t],enumerable:!0})},R=(s,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of M(e))!A.call(s,i)&&i!=="default"&&p(s,i,{get:()=>e[i],enumerable:!(t=_(e,i))||t.enumerable});return s},L=s=>R(b(p(s!=null?v(y(s)):{},"default",s&&s.__esModule&&"default"in s?{get:()=>s.default,enumerable:!0}:{value:s,enumerable:!0})),s);var a=(s,e,t)=>new Promise((i,n)=>{var r=c=>{try{l(t.next(c))}catch(u){n(u)}},g=c=>{try{l(t.throw(c))}catch(u){n(u)}},l=c=>c.done?i(c.value):Promise.resolve(c.value).then(r,g);l((t=t.apply(s,e)).next())});N(exports,{default:()=>d});var m=L(require("obsidian"));var o=L(require("obsidian")),h=class extends o.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"General Settings"}),new o.Setting(e).setName("Auto-Trim").setDesc("Automatically trim document when modified, according to the settings below.").addToggle(t=>{t.setValue(this.plugin.settings.AutoTrimDocument).onChange(i=>a(this,null,function*(){this.plugin.settings.AutoTrimDocument=i,yield this.plugin.saveSettings(),this.plugin._toggleListenerEvent(i)}))}),new o.Setting(e).setName("Auto-Trim Delay (seconds)").setDesc("Seconds to wait before auto-trimming.").addText(t=>{t.setValue(this.plugin.settings.AutoTrimTimeout.toString()).onChange(i=>a(this,null,function*(){let n=parseFloat(i);if(isNaN(n)){new o.Notice("Trim Whitespace: Enter a valid number!");return}this.plugin.settings.AutoTrimTimeout=n,yield this.plugin.saveSettings(),this.plugin._toggleListenerEvent(!1),this.plugin._initializeDebouncer(n),this.plugin._toggleListenerEvent(!0)}))}),new o.Setting(e).setName("Skip Code Blocks").setDesc("Whether to ignore code blocks when trimming whitespace.").addToggle(t=>{t.setValue(this.plugin.settings.SkipCodeBlocks).onChange(i=>a(this,null,function*(){this.plugin.settings.SkipCodeBlocks=i,yield this.plugin.saveSettings()}))}),e.createEl("h2",{text:"Trimming Rules"}),e.createEl("h3",{text:"Trailing Characters"}),new o.Setting(e).setName("Trim Trailing Spaces").setDesc("Trim spaces at the end of each line.").addToggle(t=>{t.setValue(this.plugin.settings.TrimTrailingSpaces).onChange(i=>a(this,null,function*(){this.plugin.settings.TrimTrailingSpaces=i,yield this.plugin.saveSettings()}))}),new o.Setting(e).setName("Trim Trailing Tabs").setDesc("Trim tabs at the end of each line.").addToggle(t=>{t.setValue(this.plugin.settings.TrimTrailingTabs).onChange(i=>a(this,null,function*(){this.plugin.settings.TrimTrailingTabs=i,yield this.plugin.saveSettings()}))}),new o.Setting(e).setName("Trim Trailing Lines").setDesc("Trim empty lines at the end of the document.").addToggle(t=>{t.setValue(this.plugin.settings.TrimTrailingLines).onChange(i=>a(this,null,function*(){this.plugin.settings.TrimTrailingLines=i,yield this.plugin.saveSettings()}))}),e.createEl("h3",{text:"Leading Characters"}),new o.Setting(e).setName("Trim Leading Spaces").setDesc("Trim spaces at the start of each line.").addToggle(t=>{t.setValue(this.plugin.settings.TrimLeadingSpaces).onChange(i=>a(this,null,function*(){this.plugin.settings.TrimLeadingSpaces=i,yield this.plugin.saveSettings()}))}),new o.Setting(e).setName("Trim Leading Tabs").setDesc("Trim tabs at the start of each line.").addToggle(t=>{t.setValue(this.plugin.settings.TrimLeadingTabs).onChange(i=>a(this,null,function*(){this.plugin.settings.TrimLeadingTabs=i,yield this.plugin.saveSettings()}))}),new o.Setting(e).setName("Trim Leading Lines").setDesc("Trim lines at the start of the document.").addToggle(t=>{t.setValue(this.plugin.settings.TrimLeadingLines).onChange(i=>a(this,null,function*(){this.plugin.settings.TrimLeadingLines=i,yield this.plugin.saveSettings()}))}),e.createEl("h3",{text:"Mutiple Characters"}),new o.Setting(e).setName("Trim Multiple Spaces").setDesc("Trim groups of multiple inline spaces.").addToggle(t=>{t.setValue(this.plugin.settings.TrimMultipleSpaces).onChange(i=>a(this,null,function*(){this.plugin.settings.TrimMultipleSpaces=i,yield this.plugin.saveSettings()}))}),new o.Setting(e).setName("Trim Multiple Tabs").setDesc("Trim groups of multiple inline tabs.").addToggle(t=>{t.setValue(this.plugin.settings.TrimMultipleTabs).onChange(i=>a(this,null,function*(){this.plugin.settings.TrimMultipleTabs=i,yield this.plugin.saveSettings()}))}),new o.Setting(e).setName("Trim Multiple Lines").setDesc("Trim groups of multiple blank lines.").addToggle(t=>{t.setValue(this.plugin.settings.TrimMultipleLines).onChange(i=>a(this,null,function*(){this.plugin.settings.TrimMultipleLines=i,yield this.plugin.saveSettings()}))})}};function C(s,e,t){let i={text:s.toString(),terms:[]};return t.forEach(n=>{let r=n.exec(i.text);if(!!r)for(;r;){let g=r[0];i.terms.push(g);let l=r.index,c=i.terms.length-1,u=`{{${e}${c.toString()}}}`;i.text=i.text.slice(0,l)+u+i.text.slice(l+g.length),n.lastIndex=0,r=n.exec(i.text)}}),i}function E(s,e,t){return t.forEach((i,n)=>{let r=`{{${e}${n.toString()}}}`;s=s.replace(r,i)}),s}function V(s,e){let t=new RegExp(`(${e.join("|")})+$`,"gm");return s.replace(t,"")}function W(s){return s.trimEnd()}function P(s,e){let t=new RegExp(`^(${e.join("|")})+`,"gm");return s.replace(t,"")}function B(s){return s.trimStart()}function O(s){return s.replace(/(?<!(\||^)\s*)( ){2,}(?!\s*(\||$))/gm," ")}function $(s){return s.replace(/(?<!(\||^)\s*)(\t){2,}(?!\s*(\||$))/gm,"	")}function I(s){return s.replace(/^\s+(?=(\n|\r|$))/gm,"")}function F(s,e){let t=s,i=" ",n="	";if(e.TrimTrailingSpaces||e.TrimTrailingTabs){let r=[];e.TrimTrailingSpaces&&r.push(i),e.TrimTrailingTabs&&r.push(n),t=V(t,r)}if(e.TrimTrailingLines&&(t=W(t)),e.TrimLeadingSpaces||e.TrimLeadingTabs){let r=[];e.TrimLeadingSpaces&&r.push(i),e.TrimLeadingTabs&&r.push(n),t=P(t,r)}return e.TrimLeadingLines&&(t=B(t)),e.TrimMultipleSpaces&&(t=O(t)),e.TrimMultipleTabs&&(t=$(t)),e.TrimMultipleLines&&(t=I(t)),t}function T(s,e){let t=[],i=e.SkipCodeBlocks,n="TRIM_WHITESPACE_REPLACE_",r=[new RegExp(/```([\s\S]+?)```/gm),new RegExp(/`([\s\S]+?)`/gm)];if(i){let l=C(s,n,r);s=l.text,t=l.terms}let g=F(s,e);return i&&(g=E(g,n,t)),g}var j={AutoTrimDocument:!0,AutoTrimTimeout:2.5,SkipCodeBlocks:!0,TrimTrailingSpaces:!0,TrimLeadingSpaces:!1,TrimMultipleSpaces:!1,TrimTrailingTabs:!0,TrimLeadingTabs:!1,TrimMultipleTabs:!1,TrimTrailingLines:!0,TrimLeadingLines:!1,TrimMultipleLines:!1},d=class extends m.Plugin{onload(){return a(this,null,function*(){var i,n;yield this.loadSettings(),this._initializeDebouncer(this.settings.AutoTrimTimeout),this._toggleListenerEvent(this.settings.AutoTrimDocument),this.addRibbonIcon("unindent-glyph","Trim whitespace",r=>{r.shiftKey?this.trimSelection():this.trimDocument()}),this.addCommand({id:"trim-whitespace-selection",name:"Remove whitespace in selection",editorCallback:()=>this.trimSelection()}),this.addCommand({id:"trim-whitespace-document",name:"Remove whitespace in document",editorCallback:()=>this.trimDocument()}),this.addSettingTab(new h(this.app,this));let e=(n=(i=this.app.commands)==null?void 0:i.commands)==null?void 0:n["editor:save-file"],t=e==null?void 0:e.callback;typeof t=="function"&&(e.callback=()=>{this.settings.AutoTrimDocument&&this.trimDocument(),t()})})}_getEditor(){let e=this.app.workspace.getActiveViewOfType(m.MarkdownView);return e?e.editor:null}_initializeDebouncer(e){this.debouncedTrim=(0,m.debounce)(this.trimDocument,e*1e3,!0)}_toggleListenerEvent(e){if(!this.debouncedTrim){new m.Notice("Trim Whitespace: Can't start auto trimmer!");return}e?this.registerEvent(this.app.workspace.on("editor-change",this.debouncedTrim,this)):this.app.workspace.off("editor-change",this.debouncedTrim)}trimSelection(){let e=this._getEditor();if(!e)return;let t=e.getSelection();if(t.length==0){new m.Notice("Select text to trim!");return}let i=T(t,this.settings);if(i==t)return;e.replaceSelection(i);let n=e.posToOffset(e.getCursor("to")),r=i.length,g=n-r;e.setSelection(e.offsetToPos(g),e.offsetToPos(n))}trimDocument(){let e=this._getEditor();if(!e)return;let t=e.getValue(),i=e.getCursor("from"),n=e.posToOffset(i),r=t.slice(0,n),g=T(r,this.settings),l=r.length-g.length,c=n-l,u=e.getCursor("to"),f=e.posToOffset(u),S=t.slice(0,f),D=T(S,this.settings),k=S.length-D.length,x=f-k,w=T(t,this.settings);w!=t&&(e.setValue(w),e.setSelection(e.offsetToPos(c),e.offsetToPos(x)))}loadSettings(){return a(this,null,function*(){this.settings=Object.assign({},j,yield this.loadData())})}saveSettings(){return a(this,null,function*(){yield this.saveData(this.settings)})}};0&&(module.exports={});
