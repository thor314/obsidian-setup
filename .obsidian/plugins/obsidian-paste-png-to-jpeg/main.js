/* THIS IS A GENERATED/BUNDLED FILE BY ESBUILD */
var __create = Object.create;
var __defProp = Object.defineProperty;
var __defProps = Object.defineProperties;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropDescs = Object.getOwnPropertyDescriptors;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getOwnPropSymbols = Object.getOwnPropertySymbols;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __propIsEnum = Object.prototype.propertyIsEnumerable;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __spreadValues = (a, b) => {
  for (var prop in b || (b = {}))
    if (__hasOwnProp.call(b, prop))
      __defNormalProp(a, prop, b[prop]);
  if (__getOwnPropSymbols)
    for (var prop of __getOwnPropSymbols(b)) {
      if (__propIsEnum.call(b, prop))
        __defNormalProp(a, prop, b[prop]);
    }
  return a;
};
var __spreadProps = (a, b) => __defProps(a, __getOwnPropDescs(b));
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __commonJS = (cb, mod) => function __require() {
  return mod || (0, cb[Object.keys(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;
};
var __export = (target, all) => {
  __markAsModule(target);
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && key !== "default")
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toModule = (module2) => {
  return __reExport(__markAsModule(__defProp(module2 != null ? __create(__getProtoOf(module2)) : {}, "default", module2 && module2.__esModule && "default" in module2 ? { get: () => module2.default, enumerable: true } : { value: module2, enumerable: true })), module2);
};
var __async = (__this, __arguments, generator) => {
  return new Promise((resolve, reject) => {
    var fulfilled = (value) => {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    };
    var rejected = (value) => {
      try {
        step(generator.throw(value));
      } catch (e) {
        reject(e);
      }
    };
    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
    step((generator = generator.apply(__this, __arguments)).next());
  });
};

// package.json
var require_package = __commonJS({
  "package.json"(exports, module2) {
    module2.exports = {
      name: "obsidian-paste-png-to-jpeg",
      version: "1.2.2",
      main: "main.js",
      scripts: {
        dev: "node esbuild.config.mjs",
        build: "tsc -noEmit -skipLibCheck && BUILD_ENV=production node esbuild.config.mjs && cp manifest.json build",
        version: "node version-bump.mjs && git add manifest.json versions.json",
        release: "yarn build && gh release create ${npm_package_version} build/*"
      },
      keywords: [],
      author: "Reorx",
      license: "MIT",
      devDependencies: {
        "@types/node": "^16.11.6",
        "@typescript-eslint/eslint-plugin": "^5.2.0",
        "@typescript-eslint/parser": "^5.2.0",
        "builtin-modules": "^3.2.0",
        esbuild: "0.13.12",
        obsidian: "^0.13.26",
        tslib: "2.3.1",
        typescript: "4.4.4"
      },
      dependencies: {
        "cash-dom": "^8.1.1"
      }
    };
  }
});

// src/main.ts
__export(exports, {
  default: () => PastePngToJpegPlugin
});
var import_obsidian = __toModule(require("obsidian"));

// src/utils.ts
var import_path = __toModule(require("path"));
var DEBUG = !(undefined === "production");
function debugLog(...args) {
  if (DEBUG) {
    console.log(new Date().toISOString().slice(11, 23), ...args);
  }
}
var path = {
  join(...partSegments) {
    let parts = [];
    for (let i = 0, l = partSegments.length; i < l; i++) {
      parts = parts.concat(partSegments[i].split("/"));
    }
    const newParts = [];
    for (let i = 0, l = parts.length; i < l; i++) {
      const part = parts[i];
      if (!part || part === ".")
        continue;
      else
        newParts.push(part);
    }
    if (parts[0] === "")
      newParts.unshift("");
    return newParts.join("/");
  },
  basename(fullpath) {
    const sp = fullpath.split("/");
    return sp[sp.length - 1];
  },
  filename(fullpath) {
    let filename = (0, import_path.basename)(fullpath);
    return filename.substring(0, filename.indexOf("."));
  },
  extension(fullpath) {
    const positions = [...fullpath.matchAll(new RegExp("\\.", "gi"))].map((a) => a.index);
    return fullpath.slice(positions[positions.length - 1] + 1);
  }
};
function ConvertImage(file, quality) {
  return new Promise((resolve, reject) => {
    let reader = new FileReader();
    reader.onloadend = function(e) {
      let image = new Image();
      image.onload = function() {
        let canvas = document.createElement("canvas");
        let context = canvas.getContext("2d");
        let imageWidth = image.width;
        let imageHeight = image.height;
        let data = "";
        canvas.width = imageWidth;
        canvas.height = imageHeight;
        context.fillStyle = "#fff";
        context.fillRect(0, 0, imageWidth, imageHeight);
        context.save();
        context.translate(imageWidth / 2, imageHeight / 2);
        context.drawImage(image, 0, 0, imageWidth, imageHeight, -imageWidth / 2, -imageHeight / 2, imageWidth, imageHeight);
        context.restore();
        data = canvas.toDataURL("image/jpeg", quality);
        var arrayBuffer = base64ToArrayBuffer(data);
        resolve(arrayBuffer);
      };
      image.src = e.target.result.toString();
    };
    reader.readAsDataURL(file);
  });
}
function base64ToArrayBuffer(code) {
  const parts = code.split(";base64,");
  const contentType = parts[0].split(":")[1];
  const fileExt = contentType.split("/")[1];
  const raw = window.atob(parts[1]);
  const rawLength = raw.length;
  const uInt8Array = new Uint8Array(rawLength);
  for (let i = 0; i < rawLength; ++i) {
    uInt8Array[i] = raw.charCodeAt(i);
  }
  return uInt8Array.buffer;
}

// src/main.ts
var DEFAULT_SETTINGS = {
  imageNamePattern: "{{fileName}}",
  dupNumberAtStart: false,
  dupNumberDelimiter: "-",
  autoRename: true,
  autoMove: true,
  pngToJpeg: true,
  quality: "0.6",
  dirpath: "image/"
};
var PastePngToJpegPlugin = class extends import_obsidian.Plugin {
  onload() {
    return __async(this, null, function* () {
      const pkg = require_package();
      console.log(`Plugin loading: ${pkg.name} ${pkg.version}`);
      yield this.loadSettings();
      this.registerEvent(this.app.vault.on("create", (file) => {
        if (!(file instanceof import_obsidian.TFile))
          return;
        const timeGapMs = Date.now() - file.stat.ctime;
        if (timeGapMs > 1e3)
          return;
        if (isImage(file)) {
          debugLog("pasted image created", file);
          this.renameFile(file);
        }
      }));
      this.addSettingTab(new SettingTab(this.app, this));
    });
  }
  renameFile(file) {
    return __async(this, null, function* () {
      const activeFile = this.getActiveFile();
      if (!activeFile) {
        new import_obsidian.Notice("Error: No active file found.");
        return;
      }
      let newName = yield this.generateNewName(file, activeFile);
      const sourcePath = activeFile.path;
      if (this.settings.autoMove) {
        const imagePath = this.app.vault.getConfig("attachmentFolderPath") + "/" + this.settings.dirpath;
        const isCreate = yield this.app.vault.adapter.exists(imagePath);
        if (!isCreate) {
          yield this.app.vault.createFolder(imagePath);
        }
        newName = this.settings.dirpath + newName;
      }
      const originName = file.name;
      if (this.settings.pngToJpeg) {
        let binary = yield this.app.vault.readBinary(file);
        let imgBlob = new Blob([binary]);
        let arrayBuffer = yield ConvertImage(imgBlob, Number(this.settings.quality));
        this.app.vault.modifyBinary(file, arrayBuffer);
      }
      const linkText = this.makeLinkText(file, sourcePath);
      const newPath = path.join(file.parent.path, newName);
      try {
        yield this.app.vault.rename(file, newPath);
      } catch (err) {
        new import_obsidian.Notice(`Failed to rename ${newName}: ${err}`);
        throw err;
      }
      const newLinkText = this.makeLinkText(file, sourcePath);
      debugLog("replace text", linkText, newLinkText);
      const editor = this.getActiveEditor(sourcePath);
      if (!editor) {
        new import_obsidian.Notice(`Failed to rename ${newName}: no active editor`);
        return;
      }
      const cursor = editor.getCursor();
      const line = editor.getLine(cursor.line);
      debugLog("current line", line);
      editor.transaction({
        changes: [
          {
            from: __spreadProps(__spreadValues({}, cursor), { ch: 0 }),
            to: __spreadProps(__spreadValues({}, cursor), { ch: line.length }),
            text: line.replace(linkText, newLinkText)
          }
        ]
      });
      new import_obsidian.Notice(`Renamed ${originName} to ${newName}`);
    });
  }
  makeLinkText(file, sourcePath, subpath) {
    return this.app.fileManager.generateMarkdownLink(file, sourcePath, subpath);
  }
  generateNewName(file, activeFile) {
    return __async(this, null, function* () {
      const newName = activeFile.basename + "-" + Date.now();
      const extension = this.settings.pngToJpeg ? "jpeg" : file.extension;
      return `${newName}.${extension}`;
    });
  }
  getActiveFile() {
    const view = this.app.workspace.getActiveViewOfType(import_obsidian.MarkdownView);
    const file = view == null ? void 0 : view.file;
    debugLog("active file", file == null ? void 0 : file.path);
    return file;
  }
  getActiveEditor(sourcePath) {
    const view = this.app.workspace.getActiveViewOfType(import_obsidian.MarkdownView);
    if (view) {
      if (view.file.path == sourcePath) {
        return view.editor;
      }
    }
    return null;
  }
  loadSettings() {
    return __async(this, null, function* () {
      this.settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
    });
  }
  saveSettings() {
    return __async(this, null, function* () {
      yield this.saveData(this.settings);
    });
  }
};
var IMAGE_EXTS = [
  "jpg",
  "jpeg",
  "png"
];
function isImage(file) {
  if (file instanceof import_obsidian.TFile) {
    if (IMAGE_EXTS.contains(file.extension.toLowerCase())) {
      return true;
    }
  }
  return false;
}
var SettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setName("Png to Jpeg").setDesc(`Paste images from ClipBoard to notes by copying them through various screenshot software,turn on this feature will automatically convert png to jpeg, and more quality compression volume.`).addToggle((toggle) => toggle.setValue(this.plugin.settings.pngToJpeg).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.pngToJpeg = value;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian.Setting(containerEl).setName("Quality").setDesc(`The smaller the Quality, the greater the compression ratio.`).addDropdown((toggle) => toggle.addOptions({ "0.1": "0.1", "0.2": "0.2", "0.3": "0.3", "0.4": "0.4", "0.5": "0.5", "0.6": "0.6", "0.7": "0.7", "0.8": "0.8", "0.9": "0.9", "1.0": "1.0" }).setValue(this.plugin.settings.quality).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.quality = value;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian.Setting(containerEl).setName("Auto Rname").setDesc(`Automatically names the image with the name of the previous note +'-'+ the current timestamp + '.' + file type, for example, the image in test.md will be named test-1652261724173.jpeg`).addToggle((toggle) => toggle.setValue(this.plugin.settings.autoRename).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.autoRename = value;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian.Setting(containerEl).setName("Auto Move Image").setDesc(`Automatically move images to the image directory`).addToggle((toggle) => toggle.setValue(this.plugin.settings.autoMove).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.autoMove = value;
      yield this.plugin.saveSettings();
    })));
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vc3JjL21haW4udHMiLCAiLi4vc3JjL3V0aWxzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQge1xyXG4gIEFwcCwgUGx1Z2luLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nLCBURmlsZSwgVEFic3RyYWN0RmlsZSxcclxuXHRNYXJrZG93blZpZXcsIE5vdGljZSwgVmF1bHQsXHJcbn0gZnJvbSAnb2JzaWRpYW4nO1xyXG5cclxuaW1wb3J0IHtcclxuICAgZGVidWdMb2csIHBhdGgsIENvbnZlcnRJbWFnZVxyXG59IGZyb20gJy4vdXRpbHMnO1xyXG5cclxuaW50ZXJmYWNlIFBsdWdpblNldHRpbmdzIHtcclxuXHQvLyB7e2ltYWdlTmFtZUtleX19LXt7REFURTpZWVlZTU1ERH19XHJcblx0aW1hZ2VOYW1lUGF0dGVybjogc3RyaW5nXHJcblx0ZHVwTnVtYmVyQXRTdGFydDogYm9vbGVhblxyXG5cdGR1cE51bWJlckRlbGltaXRlcjogc3RyaW5nXHJcblx0YXV0b1JlbmFtZTogYm9vbGVhblxyXG5cdGF1dG9Nb3ZlOmJvb2xlYW5cclxuXHRwbmdUb0pwZWc6IGJvb2xlYW5cclxuXHRxdWFsaXR5OiBzdHJpbmdcclxuXHRkaXJwYXRoOiBzdHJpbmdcclxufVxyXG5cclxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogUGx1Z2luU2V0dGluZ3MgPSB7XHJcblx0aW1hZ2VOYW1lUGF0dGVybjogJ3t7ZmlsZU5hbWV9fScsXHJcblx0ZHVwTnVtYmVyQXRTdGFydDogZmFsc2UsXHJcblx0ZHVwTnVtYmVyRGVsaW1pdGVyOiAnLScsXHJcblx0YXV0b1JlbmFtZTogdHJ1ZSxcclxuXHRhdXRvTW92ZTp0cnVlLFxyXG5cdHBuZ1RvSnBlZzp0cnVlLFxyXG5cdHF1YWxpdHk6JzAuNicsXHJcblx0ZGlycGF0aDpcImltYWdlL1wiIFxyXG59XHJcblxyXG5jb25zdCBQQVNURURfSU1BR0VfUFJFRklYID0gJ1Bhc3RlZCBpbWFnZSAnXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQYXN0ZVBuZ1RvSnBlZ1BsdWdpbiBleHRlbmRzIFBsdWdpbiB7XHJcblx0c2V0dGluZ3M6IFBsdWdpblNldHRpbmdzXHJcblxyXG5cdGFzeW5jIG9ubG9hZCgpIFxyXG5cdHtcclxuXHRcdGNvbnN0IHBrZyA9IHJlcXVpcmUoJy4uL3BhY2thZ2UuanNvbicpXHJcblx0XHRjb25zb2xlLmxvZyhgUGx1Z2luIGxvYWRpbmc6ICR7cGtnLm5hbWV9ICR7cGtnLnZlcnNpb259YClcclxuXHRcdGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XHJcblxyXG5cdFx0dGhpcy5yZWdpc3RlckV2ZW50KFxyXG5cdFx0XHR0aGlzLmFwcC52YXVsdC5vbignY3JlYXRlJywgKGZpbGUpID0+IFxyXG5cdFx0XHR7XHJcblx0XHRcdFx0aWYgKCEoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSlcclxuXHRcdFx0XHRcdHJldHVyblxyXG5cclxuXHRcdFx0XHRjb25zdCB0aW1lR2FwTXMgPSBEYXRlLm5vdygpIC0gZmlsZS5zdGF0LmN0aW1lO1xyXG5cclxuXHRcdFx0XHQvLyBpZiB0aGUgcGFzdGVkIGltYWdlIGlzIGNyZWF0ZWQgbW9yZSB0aGFuIDEgc2Vjb25kIGFnbywgaWdub3JlIGl0XHJcblx0XHRcdFx0aWYgKHRpbWVHYXBNcyA+IDEwMDApXHJcblx0XHRcdFx0XHRyZXR1cm5cclxuXHJcblx0XHRcdFx0aWYgKGlzSW1hZ2UoZmlsZSkpIFxyXG5cdFx0XHRcdHtcclxuXHRcdFx0XHRcdGRlYnVnTG9nKCdwYXN0ZWQgaW1hZ2UgY3JlYXRlZCcsIGZpbGUpXHJcblx0XHRcdFx0XHR0aGlzLnJlbmFtZUZpbGUoZmlsZSk7XHJcblx0XHRcdFx0fSBcclxuXHRcdFx0fSlcclxuXHRcdClcclxuXHJcblx0XHQvLyBhZGQgc2V0dGluZ3MgdGFiXHJcblx0XHR0aGlzLmFkZFNldHRpbmdUYWIobmV3IFNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcclxuXHR9XHJcblxyXG5cdGFzeW5jIHJlbmFtZUZpbGUoZmlsZTogVEZpbGUpIFxyXG5cdHtcclxuXHRcdGNvbnN0IGFjdGl2ZUZpbGUgPSB0aGlzLmdldEFjdGl2ZUZpbGUoKVxyXG5cdFx0aWYgKCFhY3RpdmVGaWxlKSBcclxuXHRcdHtcclxuXHRcdFx0bmV3IE5vdGljZSgnRXJyb3I6IE5vIGFjdGl2ZSBmaWxlIGZvdW5kLicpXHJcblx0XHRcdHJldHVyblxyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGRlZHVwbGljYXRlIG5hbWVcclxuXHRcdGxldCBuZXdOYW1lOnN0cmluZyA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVOZXdOYW1lKGZpbGUsIGFjdGl2ZUZpbGUpO1xyXG5cdFx0Y29uc3Qgc291cmNlUGF0aDpzdHJpbmcgPSBhY3RpdmVGaWxlLnBhdGg7XHJcblxyXG5cdFx0aWYoIHRoaXMuc2V0dGluZ3MuYXV0b01vdmUgKVxyXG5cdFx0e1xyXG5cdFx0XHRjb25zdCBpbWFnZVBhdGggPSB0aGlzLmFwcC52YXVsdC5nZXRDb25maWcoXCJhdHRhY2htZW50Rm9sZGVyUGF0aFwiKSArIFwiL1wiICsgdGhpcy5zZXR0aW5ncy5kaXJwYXRoO1xyXG5cdFx0XHRjb25zdCBpc0NyZWF0ZSA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIuZXhpc3RzKGltYWdlUGF0aCk7XHJcblx0XHRcdGlmKCAhaXNDcmVhdGUgKVxyXG5cdFx0XHR7XHJcblx0XHRcdFx0YXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlRm9sZGVyKGltYWdlUGF0aCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdG5ld05hbWUgPSB0aGlzLnNldHRpbmdzLmRpcnBhdGggKyBuZXdOYW1lO1xyXG5cdFx0fVxyXG5cclxuXHRcdGNvbnN0IG9yaWdpbk5hbWUgPSBmaWxlLm5hbWU7XHJcblx0XHRpZiggdGhpcy5zZXR0aW5ncy5wbmdUb0pwZWcpXHJcblx0XHR7XHJcblx0XHRcdGxldCBiaW5hcnk6QXJyYXlCdWZmZXIgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkQmluYXJ5KGZpbGUpO1xyXG5cdFx0XHRsZXQgaW1nQmxvYjpCbG9iID0gbmV3IEJsb2IoIFtiaW5hcnldICk7XHJcblx0XHRcdGxldCBhcnJheUJ1ZmZlcjpBcnJheUJ1ZmZlciA9IGF3YWl0IENvbnZlcnRJbWFnZShpbWdCbG9iLCBOdW1iZXIoIHRoaXMuc2V0dGluZ3MucXVhbGl0eSApICk7XHJcblx0XHRcdHRoaXMuYXBwLnZhdWx0Lm1vZGlmeUJpbmFyeShmaWxlLGFycmF5QnVmZmVyKTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBnZXQgb3JpZ2luIGZpbGUgbGluayBiZWZvcmUgcmVuYW1pbmdcclxuXHRcdGNvbnN0IGxpbmtUZXh0ID0gdGhpcy5tYWtlTGlua1RleHQoZmlsZSwgc291cmNlUGF0aCk7XHJcblxyXG5cdFx0Ly8gZmlsZSBzeXN0ZW0gb3BlcmF0aW9uXHJcblx0XHRjb25zdCBuZXdQYXRoID0gcGF0aC5qb2luKGZpbGUucGFyZW50LnBhdGgsIG5ld05hbWUpO1xyXG5cdFx0dHJ5IFxyXG5cdFx0e1xyXG5cdFx0XHRhd2FpdCB0aGlzLmFwcC52YXVsdC5yZW5hbWUoZmlsZSwgbmV3UGF0aCk7XHJcblx0XHR9IFxyXG5cdFx0Y2F0Y2ggKGVycikgXHJcblx0XHR7XHJcblx0XHRcdG5ldyBOb3RpY2UoYEZhaWxlZCB0byByZW5hbWUgJHtuZXdOYW1lfTogJHtlcnJ9YClcclxuXHRcdFx0dGhyb3cgZXJyXHJcblx0XHR9XHJcblxyXG5cdFx0Y29uc3QgbmV3TGlua1RleHQgPSB0aGlzLm1ha2VMaW5rVGV4dChmaWxlLCBzb3VyY2VQYXRoKTtcclxuXHRcdGRlYnVnTG9nKCdyZXBsYWNlIHRleHQnLCBsaW5rVGV4dCwgbmV3TGlua1RleHQpXHJcblxyXG5cdFx0Ly8gaW4gY2FzZSBmaWxlTWFuYWdlci5yZW5hbWVGaWxlIG1heSBub3QgdXBkYXRlIHRoZSBpbnRlcm5hbCBsaW5rIGluIHRoZSBhY3RpdmUgZmlsZSxcclxuXHRcdC8vIHdlIG1hbnVhbGx5IHJlcGxhY2UgYnkgbWFuaXB1bGF0aW5nIHRoZSBlZGl0b3JcclxuXHRcdGNvbnN0IGVkaXRvciA9IHRoaXMuZ2V0QWN0aXZlRWRpdG9yKCBzb3VyY2VQYXRoICk7XHJcblx0XHRpZiAoIWVkaXRvcikgXHJcblx0XHR7XHJcblx0XHRcdG5ldyBOb3RpY2UoYEZhaWxlZCB0byByZW5hbWUgJHtuZXdOYW1lfTogbm8gYWN0aXZlIGVkaXRvcmApXHJcblx0XHRcdHJldHVyblxyXG5cdFx0fVxyXG5cclxuXHRcdGNvbnN0IGN1cnNvciA9IGVkaXRvci5nZXRDdXJzb3IoKVxyXG5cdFx0Y29uc3QgbGluZSA9IGVkaXRvci5nZXRMaW5lKGN1cnNvci5saW5lKVxyXG5cdFx0ZGVidWdMb2coJ2N1cnJlbnQgbGluZScsIGxpbmUpXHJcblx0XHQvLyBjb25zb2xlLmxvZygnZWRpdG9yIGNvbnRleHQnLCBjdXJzb3IsIClcclxuXHRcdGVkaXRvci50cmFuc2FjdGlvbih7XHJcblx0XHRcdGNoYW5nZXM6IFtcclxuXHRcdFx0XHR7XHJcblx0XHRcdFx0XHRmcm9tOiB7Li4uY3Vyc29yLCBjaDogMH0sXHJcblx0XHRcdFx0XHR0bzogey4uLmN1cnNvciwgY2g6IGxpbmUubGVuZ3RofSxcclxuXHRcdFx0XHRcdHRleHQ6IGxpbmUucmVwbGFjZShsaW5rVGV4dCwgbmV3TGlua1RleHQpLFxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XVxyXG5cdFx0fSlcclxuXHJcblx0XHRuZXcgTm90aWNlKGBSZW5hbWVkICR7b3JpZ2luTmFtZX0gdG8gJHtuZXdOYW1lfWApXHJcblx0fVxyXG5cclxuXHRtYWtlTGlua1RleHQoIGZpbGU6IFRGaWxlLCBzb3VyY2VQYXRoOiBzdHJpbmcsIHN1YnBhdGg/OnN0cmluZyk6IHN0cmluZyBcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5hcHAuZmlsZU1hbmFnZXIuZ2VuZXJhdGVNYXJrZG93bkxpbmsoZmlsZSwgc291cmNlUGF0aCxzdWJwYXRoKVxyXG5cdH1cclxuXHJcblx0Ly8gcmV0dXJucyBhIG5ldyBuYW1lIGZvciB0aGUgaW5wdXQgZmlsZSwgd2l0aCBleHRlbnNpb25cclxuXHRhc3luYyBnZW5lcmF0ZU5ld05hbWUoZmlsZTogVEZpbGUsIGFjdGl2ZUZpbGU6IFRGaWxlKTpQcm9taXNlPHN0cmluZz5cclxuXHR7XHJcblx0XHRjb25zdCBuZXdOYW1lID0gYWN0aXZlRmlsZS5iYXNlbmFtZSArICctJyArIERhdGUubm93KCk7XHJcblx0XHRjb25zdCBleHRlbnNpb24gPSB0aGlzLnNldHRpbmdzLnBuZ1RvSnBlZyA/ICdqcGVnJyA6IGZpbGUuZXh0ZW5zaW9uO1xyXG5cdFx0XHJcblx0XHRyZXR1cm4gYCR7bmV3TmFtZX0uJHtleHRlbnNpb259YDtcclxuXHR9XHJcblxyXG5cdGdldEFjdGl2ZUZpbGUoKSBcclxuXHR7XHJcblx0XHRjb25zdCB2aWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KVxyXG5cdFx0Y29uc3QgZmlsZSA9IHZpZXc/LmZpbGVcclxuXHRcdGRlYnVnTG9nKCdhY3RpdmUgZmlsZScsIGZpbGU/LnBhdGgpXHJcblx0XHRyZXR1cm4gZmlsZVxyXG5cdH1cclxuXHJcblx0Z2V0QWN0aXZlRWRpdG9yKHNvdXJjZVBhdGg6c3RyaW5nKSBcclxuXHR7XHJcblx0XHRjb25zdCB2aWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KVxyXG5cdFx0aWYoIHZpZXcgKVxyXG5cdFx0e1xyXG5cdFx0XHRpZiggdmlldy5maWxlLnBhdGggPT0gc291cmNlUGF0aCApXHJcblx0XHRcdHtcclxuXHRcdFx0XHRyZXR1cm4gdmlldy5lZGl0b3JcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIG51bGxcclxuXHR9XHJcblxyXG5cdGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcclxuXHRcdHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xyXG5cdH1cclxuXHJcblx0YXN5bmMgc2F2ZVNldHRpbmdzKCkge1xyXG5cdFx0YXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcclxuXHR9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzUGFzdGVkSW1hZ2UoZmlsZTogVEFic3RyYWN0RmlsZSk6IGJvb2xlYW4ge1xyXG5cdGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcclxuXHRcdGlmIChmaWxlLm5hbWUuc3RhcnRzV2l0aChQQVNURURfSU1BR0VfUFJFRklYKSkge1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZVxyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gZmFsc2VcclxufVxyXG5cclxuY29uc3QgSU1BR0VfRVhUUyA9IFtcclxuXHQnanBnJywgJ2pwZWcnLCAncG5nJ1xyXG5dXHJcblxyXG5mdW5jdGlvbiBpc0ltYWdlKGZpbGU6IFRBYnN0cmFjdEZpbGUpOiBib29sZWFuIHtcclxuXHRpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XHJcblx0XHRpZiAoSU1BR0VfRVhUUy5jb250YWlucyhmaWxlLmV4dGVuc2lvbi50b0xvd2VyQ2FzZSgpKSkge1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZVxyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gZmFsc2VcclxufVxyXG5cclxuY2xhc3MgU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xyXG5cdHBsdWdpbjogUGFzdGVQbmdUb0pwZWdQbHVnaW47XHJcblxyXG5cdGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IFBhc3RlUG5nVG9KcGVnUGx1Z2luKSB7XHJcblx0XHRzdXBlcihhcHAsIHBsdWdpbik7XHJcblx0XHR0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuXHR9XHJcblxyXG5cdGRpc3BsYXkoKTogdm9pZCB7XHJcblx0XHRjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xyXG5cdFx0Y29udGFpbmVyRWwuZW1wdHkoKTtcclxuXHJcblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuXHRcdFx0LnNldE5hbWUoJ1BuZyB0byBKcGVnJylcclxuXHRcdFx0LnNldERlc2MoYFBhc3RlIGltYWdlcyBmcm9tIENsaXBCb2FyZCB0byBub3RlcyBieSBjb3B5aW5nIHRoZW0gdGhyb3VnaCB2YXJpb3VzIHNjcmVlbnNob3Qgc29mdHdhcmUsdHVybiBvbiB0aGlzIGZlYXR1cmUgd2lsbCBhdXRvbWF0aWNhbGx5IGNvbnZlcnQgcG5nIHRvIGpwZWcsIGFuZCBtb3JlIHF1YWxpdHkgY29tcHJlc3Npb24gdm9sdW1lLmApXHJcblx0XHRcdC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxyXG5cdFx0XHRcdC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5wbmdUb0pwZWcpXHJcblx0XHRcdFx0Lm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MucG5nVG9KcGVnID0gdmFsdWU7XHJcblx0XHRcdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdCkpO1x0XHJcblx0XHRcdFxyXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcblx0XHRcdC5zZXROYW1lKCdRdWFsaXR5JylcclxuXHRcdFx0LnNldERlc2MoYFRoZSBzbWFsbGVyIHRoZSBRdWFsaXR5LCB0aGUgZ3JlYXRlciB0aGUgY29tcHJlc3Npb24gcmF0aW8uYClcclxuXHRcdFx0LmFkZERyb3Bkb3duKHRvZ2dsZSA9PiB0b2dnbGVcclxuXHRcdFx0XHQuYWRkT3B0aW9ucyh7JzAuMSc6JzAuMScsJzAuMic6JzAuMicsJzAuMyc6JzAuMycsJzAuNCc6JzAuNCcsJzAuNSc6JzAuNScsJzAuNic6JzAuNicsJzAuNyc6JzAuNycsJzAuOCc6JzAuOCcsJzAuOSc6JzAuOScsJzEuMCc6JzEuMCd9KVxyXG5cdFx0XHRcdC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5xdWFsaXR5KVxyXG5cdFx0XHRcdC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuXHRcdFx0XHRcdHRoaXMucGx1Z2luLnNldHRpbmdzLnF1YWxpdHkgPSB2YWx1ZTtcclxuXHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0KSk7XHRcclxuXHRcdFx0XHJcblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuXHRcdFx0LnNldE5hbWUoJ0F1dG8gUm5hbWUnKVxyXG5cdFx0XHQuc2V0RGVzYyhgQXV0b21hdGljYWxseSBuYW1lcyB0aGUgaW1hZ2Ugd2l0aCB0aGUgbmFtZSBvZiB0aGUgcHJldmlvdXMgbm90ZSArJy0nKyB0aGUgY3VycmVudCB0aW1lc3RhbXAgKyAnLicgKyBmaWxlIHR5cGUsIGZvciBleGFtcGxlLCB0aGUgaW1hZ2UgaW4gdGVzdC5tZCB3aWxsIGJlIG5hbWVkIHRlc3QtMTY1MjI2MTcyNDE3My5qcGVnYClcclxuXHRcdFx0LmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXHJcblx0XHRcdFx0LnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9SZW5hbWUpXHJcblx0XHRcdFx0Lm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MuYXV0b1JlbmFtZSA9IHZhbHVlO1xyXG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpKTtcdFxyXG5cdFx0XHRcclxuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG5cdFx0XHQuc2V0TmFtZSgnQXV0byBNb3ZlIEltYWdlJylcclxuXHRcdFx0LnNldERlc2MoYEF1dG9tYXRpY2FsbHkgbW92ZSBpbWFnZXMgdG8gdGhlIGltYWdlIGRpcmVjdG9yeWApXHJcblx0XHRcdC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxyXG5cdFx0XHRcdC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5hdXRvTW92ZSlcclxuXHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcblx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zZXR0aW5ncy5hdXRvTW92ZSA9IHZhbHVlO1xyXG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHQpKTtcdFx0XHRcdFxyXG5cdH1cclxufVxyXG4iLCAiaW1wb3J0IHsgQXBwLCBWYXVsdCB9IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0IHsgYmFzZW5hbWUgfSBmcm9tICdwYXRoJztcclxuXHJcbmV4cG9ydCBjb25zdCBERUJVRyA9ICEocHJvY2Vzcy5lbnYuQlVJTERfRU5WID09PSAncHJvZHVjdGlvbicpXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGVidWdMb2coLi4uYXJnczogYW55W10pIHtcclxuXHRpZiAoREVCVUcpIHtcclxuXHRcdGNvbnNvbGUubG9nKChuZXcgRGF0ZSgpKS50b0lTT1N0cmluZygpLnNsaWNlKDExLCAyMyksIC4uLmFyZ3MpXHJcblx0fVxyXG59XHJcblxyXG5pbnRlcmZhY2UgRWxlbWVudFRyZWVPcHRpb25zIGV4dGVuZHMgRG9tRWxlbWVudEluZm8ge1xyXG5cdHRhZzoga2V5b2YgSFRNTEVsZW1lbnRUYWdOYW1lTWFwXHJcblx0Y2hpbGRyZW4/OiBFbGVtZW50VHJlZU9wdGlvbnNbXVxyXG59XHJcblxyXG5pbnRlcmZhY2UgRWxlbWVudFRyZWUge1xyXG5cdGVsOiBIVE1MRWxlbWVudFxyXG5cdGNoaWxkcmVuOiBFbGVtZW50VHJlZVtdXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVFbGVtZW50VHJlZShyb290RWw6IEhUTUxFbGVtZW50LCBvcHRzOiBFbGVtZW50VHJlZU9wdGlvbnMpOiBFbGVtZW50VHJlZSB7XHJcblx0Y29uc3QgcmVzdWx0OiBFbGVtZW50VHJlZSA9IHtcclxuXHRcdGVsOiByb290RWwuY3JlYXRlRWwob3B0cy50YWcsIG9wdHMgYXMgRG9tRWxlbWVudEluZm8pLFxyXG5cdFx0Y2hpbGRyZW46IFtdLFxyXG5cdH1cclxuXHRjb25zdCBjaGlsZHJlbiA9IG9wdHMuY2hpbGRyZW4gfHwgW11cclxuXHRmb3IgKGNvbnN0IGNoaWxkIG9mIGNoaWxkcmVuKSB7XHJcblx0XHRyZXN1bHQuY2hpbGRyZW4ucHVzaChjcmVhdGVFbGVtZW50VHJlZShyZXN1bHQuZWwsIGNoaWxkKSlcclxuXHR9XHJcblx0cmV0dXJuIHJlc3VsdFxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgcGF0aCA9IHtcclxuXHQvLyBDcmVkaXQ6IEBjcmVhdGlvbml4L3BhdGguanNcclxuXHRqb2luKC4uLnBhcnRTZWdtZW50czogc3RyaW5nW10pOiBzdHJpbmcge1xyXG5cdFx0Ly8gU3BsaXQgdGhlIGlucHV0cyBpbnRvIGEgbGlzdCBvZiBwYXRoIGNvbW1hbmRzLlxyXG5cdFx0bGV0IHBhcnRzOiBzdHJpbmdbXSA9IFtdXHJcblx0XHRmb3IgKGxldCBpID0gMCwgbCA9IHBhcnRTZWdtZW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuXHRcdFx0cGFydHMgPSBwYXJ0cy5jb25jYXQocGFydFNlZ21lbnRzW2ldLnNwbGl0KCcvJykpXHJcblx0XHR9XHJcblx0XHQvLyBJbnRlcnByZXQgdGhlIHBhdGggY29tbWFuZHMgdG8gZ2V0IHRoZSBuZXcgcmVzb2x2ZWQgcGF0aC5cclxuXHRcdGNvbnN0IG5ld1BhcnRzID0gW11cclxuXHRcdGZvciAobGV0IGkgPSAwLCBsID0gcGFydHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XHJcblx0XHRcdGNvbnN0IHBhcnQgPSBwYXJ0c1tpXVxyXG5cdFx0XHQvLyBSZW1vdmUgbGVhZGluZyBhbmQgdHJhaWxpbmcgc2xhc2hlc1xyXG5cdFx0XHQvLyBBbHNvIHJlbW92ZSBcIi5cIiBzZWdtZW50c1xyXG5cdFx0XHRpZiAoIXBhcnQgfHwgcGFydCA9PT0gJy4nKSBjb250aW51ZVxyXG5cdFx0XHQvLyBQdXNoIG5ldyBwYXRoIHNlZ21lbnRzLlxyXG5cdFx0XHRlbHNlIG5ld1BhcnRzLnB1c2gocGFydClcclxuXHRcdH1cclxuXHRcdC8vIFByZXNlcnZlIHRoZSBpbml0aWFsIHNsYXNoIGlmIHRoZXJlIHdhcyBvbmUuXHJcblx0XHRpZiAocGFydHNbMF0gPT09ICcnKSBuZXdQYXJ0cy51bnNoaWZ0KCcnKVxyXG5cdFx0Ly8gVHVybiBiYWNrIGludG8gYSBzaW5nbGUgc3RyaW5nIHBhdGguXHJcblx0XHRyZXR1cm4gbmV3UGFydHMuam9pbignLycpXHJcblx0fSxcclxuXHJcblx0Ly8gcmV0dXJucyB0aGUgbGFzdCBwYXJ0IG9mIGEgcGF0aCwgZS5nLiAnZm9vLmpwZydcclxuXHRiYXNlbmFtZShmdWxscGF0aDogc3RyaW5nKTogc3RyaW5nIHtcclxuXHRcdGNvbnN0IHNwID0gZnVsbHBhdGguc3BsaXQoJy8nKVxyXG5cdFx0cmV0dXJuIHNwW3NwLmxlbmd0aCAtIDFdXHJcblx0fSxcclxuXHJcblx0ZmlsZW5hbWUoZnVsbHBhdGg6c3RyaW5nKTpzdHJpbmdcclxuXHR7XHJcblx0XHRsZXQgZmlsZW5hbWUgPSBiYXNlbmFtZShmdWxscGF0aCk7XHJcblxyXG5cdFx0cmV0dXJuIGZpbGVuYW1lLnN1YnN0cmluZygwLGZpbGVuYW1lLmluZGV4T2YoJy4nKSApXHJcblx0fSxcclxuXHJcblx0Ly8gcmV0dXJuIGV4dGVuc2lvbiB3aXRob3V0IGRvdCwgZS5nLiAnanBnJ1xyXG5cdGV4dGVuc2lvbihmdWxscGF0aDogc3RyaW5nKTogc3RyaW5nIHtcclxuXHRcdGNvbnN0IHBvc2l0aW9ucyA9IFsuLi5mdWxscGF0aC5tYXRjaEFsbChuZXcgUmVnRXhwKCdcXFxcLicsICdnaScpKV0ubWFwKGEgPT4gYS5pbmRleClcclxuXHRcdHJldHVybiBmdWxscGF0aC5zbGljZShwb3NpdGlvbnNbcG9zaXRpb25zLmxlbmd0aCAtIDFdICsgMSlcclxuXHR9LFxyXG59XHJcblxyXG5jb25zdCBmaWxlbmFtZU5vdEFsbG93ZWRDaGFycyA9IC9bXmEtekEtWjAtOX5gIUAkJiooKVxcLV89K3t9OydcIiw8Lj4/IF0vZ1xyXG5cclxuZXhwb3J0IGNvbnN0IHNhbml0aXplciA9IHtcclxuXHRmaWxlbmFtZShzOiBzdHJpbmcpOiBzdHJpbmcge1xyXG5cdFx0cmV0dXJuIHMucmVwbGFjZShmaWxlbmFtZU5vdEFsbG93ZWRDaGFycywgJycpLnRyaW0oKVxyXG5cdH0sXHJcblxyXG5cdGRlbGltaXRlcihzOiBzdHJpbmcpOiBzdHJpbmcge1xyXG5cdFx0cyA9IHRoaXMuZmlsZW5hbWUocylcclxuXHRcdC8vIHVzZSBkZWZhdWx0ICctJyBpZiBubyB2YWxpZCBjaGFycyBmb3VuZFxyXG5cdFx0aWYgKCFzKSBzID0gJy0nXHJcblx0XHRyZXR1cm4gc1xyXG5cdH1cclxufVxyXG5cclxuLy8gcmVmOiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNjk2OTQ4Ni81OTYyMDZcclxuZXhwb3J0IGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBzLnJlcGxhY2UoL1suKis/XiR7fSgpfFtcXF1cXFxcXS9nLCAnXFxcXCQmJyk7XHJcbn1cclxuXHJcblxyXG5pbnRlcmZhY2UgQ29tcG9zaXRpb25TdGF0ZSB7XHJcblx0bG9jazogYm9vbGVhblxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbG9ja0lucHV0TWV0aG9kQ29tcG9zaXRpb24oZWw6IEhUTUxJbnB1dEVsZW1lbnQpOiBDb21wb3NpdGlvblN0YXRlIHtcclxuXHRjb25zdCBzdGF0ZTogQ29tcG9zaXRpb25TdGF0ZSA9IHtcclxuXHRcdGxvY2s6IGZhbHNlLFxyXG5cdH1cclxuXHRlbC5hZGRFdmVudExpc3RlbmVyKCdjb21wb3NpdGlvbnN0YXJ0JywgKCkgPT4ge1xyXG5cdFx0c3RhdGUubG9jayA9IHRydWVcclxuXHR9KVxyXG5cdGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbXBvc2l0aW9uZW5kJywgKCkgPT4ge1xyXG5cdFx0c3RhdGUubG9jayA9IGZhbHNlXHJcblx0fSlcclxuXHRyZXR1cm4gc3RhdGVcclxufVxyXG5cclxuXHJcbmludGVyZmFjZSBWYXVsdENvbmZpZyB7XHJcblx0dXNlTWFya2Rvd25MaW5rcz86IGJvb2xlYW5cclxufVxyXG5cclxuaW50ZXJmYWNlIFZhdWx0V2l0aENvbmZpZyBleHRlbmRzIFZhdWx0IHtcclxuXHRjb25maWc/OiBWYXVsdENvbmZpZyxcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFZhdWx0Q29uZmlnKGFwcDogQXBwKTogVmF1bHRDb25maWd8bnVsbCB7XHJcblx0Y29uc3QgdmF1bHQgPSBhcHAudmF1bHQgYXMgVmF1bHRXaXRoQ29uZmlnXHJcblx0cmV0dXJuIHZhdWx0LmNvbmZpZ1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gQ29udmVydEltYWdlKGZpbGU6QmxvYiwgcXVhbGl0eTpudW1iZXIpOlByb21pc2U8QXJyYXlCdWZmZXI+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiBcclxuXHR7XHJcbiAgICAgICAgbGV0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7IC8vXHU4QkZCXHU1M0Q2ZmlsZVxyXG4gICAgICAgIHJlYWRlci5vbmxvYWRlbmQgPSBmdW5jdGlvbiAoZSkgXHJcblx0XHR7XHJcbiAgICAgICAgICAgIGxldCBpbWFnZSA9IG5ldyBJbWFnZSgpIC8vXHU2NUIwXHU1RUZBXHU0RTAwXHU0RTJBaW1nXHU2ODA3XHU3QjdFXHVGRjA4XHU4RkQ4XHU2Q0ExXHU1RDRDXHU1MTY1RE9NXHU4MjgyXHU3MEI5KVxyXG4gICAgICAgICAgICBpbWFnZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSBcclxuXHRcdFx0e1xyXG4gICAgICAgICAgICAgICAgbGV0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG4gICAgICAgICAgICAgICAgbGV0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcclxuICAgICAgICAgICAgICAgIGxldCBpbWFnZVdpZHRoID0gaW1hZ2Uud2lkdGg7XHJcbiAgICAgICAgICAgICAgICBsZXQgaW1hZ2VIZWlnaHQgPSBpbWFnZS5oZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICBsZXQgZGF0YSA9ICcnO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IGltYWdlV2lkdGg7XHJcbiAgICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaW1hZ2VIZWlnaHQ7XHJcblxyXG5cdFx0XHRcdGNvbnRleHQuZmlsbFN0eWxlID0gJyNmZmYnO1xyXG5cdFx0XHRcdGNvbnRleHQuZmlsbFJlY3QoMCwgMCwgaW1hZ2VXaWR0aCwgaW1hZ2VIZWlnaHQpO1xyXG5cdFx0XHRcdGNvbnRleHQuc2F2ZSgpO1xyXG5cclxuXHRcdFx0XHRjb250ZXh0LnRyYW5zbGF0ZShpbWFnZVdpZHRoIC8gMiwgaW1hZ2VIZWlnaHQgLyAyKTtcclxuICAgICAgICAgICAgICAgIGNvbnRleHQuZHJhd0ltYWdlKGltYWdlLCAwLCAwLCBpbWFnZVdpZHRoLCBpbWFnZUhlaWdodCwtaW1hZ2VXaWR0aC8yLC1pbWFnZUhlaWdodC8yLGltYWdlV2lkdGgsaW1hZ2VIZWlnaHQpO1xyXG5cdFx0XHRcdGNvbnRleHQucmVzdG9yZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGRhdGEgPSBjYW52YXMudG9EYXRhVVJMKCdpbWFnZS9qcGVnJyxxdWFsaXR5KTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgYXJyYXlCdWZmZXIgPSBiYXNlNjRUb0FycmF5QnVmZmVyKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShhcnJheUJ1ZmZlcilcclxuICAgICAgICAgICAgfVxyXG5cclxuXHRcdFx0aW1hZ2Uuc3JjID0gZS50YXJnZXQucmVzdWx0LnRvU3RyaW5nKCkgLy9cdTVDMDZcdTU2RkVcdTcyNDdcdTc2ODRcdThERUZcdTVGODRcdThCQkVcdTYyMTBmaWxlXHU4REVGXHU1Rjg0XHJcbiAgICAgICAgfVxyXG5cclxuXHRcdHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xyXG4gICAgfSlcclxufVxyXG5cclxuZnVuY3Rpb24gYmFzZTY0VG9BcnJheUJ1ZmZlciAoY29kZTpzdHJpbmcpOkFycmF5QnVmZmVyXHJcbntcclxuICAgIGNvbnN0IHBhcnRzID0gY29kZS5zcGxpdChcIjtiYXNlNjQsXCIpO1xyXG4gICAgY29uc3QgY29udGVudFR5cGUgPSBwYXJ0c1swXS5zcGxpdChcIjpcIilbMV07XHJcbiAgICBjb25zdCBmaWxlRXh0ID0gY29udGVudFR5cGUuc3BsaXQoXCIvXCIpWzFdO1xyXG4gICAgY29uc3QgcmF3ID0gd2luZG93LmF0b2IocGFydHNbMV0pO1xyXG4gICAgY29uc3QgcmF3TGVuZ3RoID0gcmF3Lmxlbmd0aDtcclxuXHJcbiAgICBjb25zdCB1SW50OEFycmF5ID0gbmV3IFVpbnQ4QXJyYXkocmF3TGVuZ3RoKTtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJhd0xlbmd0aDsgKytpKSBcclxuXHR7XHJcbiAgICAgICAgdUludDhBcnJheVtpXSA9IHJhdy5jaGFyQ29kZUF0KGkpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHVJbnQ4QXJyYXkuYnVmZmVyO1xyXG59OyJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBLHNCQUdPOzs7QUNGUCxrQkFBeUI7QUFFbEIsSUFBTSxRQUFRLENBQUUsZUFBMEI7QUFFMUMscUJBQXFCLE1BQWE7QUFDeEMsTUFBSSxPQUFPO0FBQ1YsWUFBUSxJQUFLLElBQUksT0FBUSxjQUFjLE1BQU0sSUFBSSxLQUFLLEdBQUc7QUFBQTtBQUFBO0FBMEJwRCxJQUFNLE9BQU87QUFB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
